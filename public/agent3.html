<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Agent Admin</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f0f2f5; }
    #chatContainer { border:1px solid #ccc; border-radius:5px; max-height:500px; overflow-y:auto; padding:10px; background:white; }
    #messageInput { width:80%; padding:10px; border-radius:5px; border:1px solid #ccc; margin-top:10px; }
    #sendBtn { padding:10px 15px; margin-top:10px; background:#1976d2; color:white; border:none; border-radius:5px; cursor:pointer; }
    #activityLog { border:1px solid #ccc; border-radius:5px; max-height:200px; overflow-y:auto; padding:10px; margin-top:10px; background:white; }
  </style>
</head>
<body>
  <h1>Agent Admin Dashboard</h1>
  <p id="agentInfo"></p>
  <div id="chatContainer"></div>
  <input type="text" id="messageInput" placeholder="Type message...">
  <button id="sendBtn">Send</button>
  <h3>Activity Logs</h3>
  <div id="activityLog"></div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
  const socket = io("https://chat-backend-p2b9.onrender.com",{transports:['websocket','polling']});
  let agentId = prompt('Enter your Agent ID:');
  document.getElementById('agentInfo').textContent = 'Logged in as Agent: ' + agentId;

  let assignedChats = [];

  // Connect agent
  socket.emit('agent_connect', {agentId});

  // Handle incoming user messages
  socket.on('user_message', (msg) => {
    assignedChats.push(msg);
    renderChats();
    logActivity(`New message from ${msg.from}: ${msg.content}`);
  });

  // Handle incoming user images
  socket.on('user_image', (msg) => {
    assignedChats.push(msg);
    renderChats();
    logActivity(`New image from ${msg.from}`);
  });

  // Handle broadcasts from Super Admin
  socket.on('super_message', (msg) => {
    logActivity(`SuperAdmin: ${msg.content}`);
  });

  function renderChats() {
    const chatContainer = document.getElementById('chatContainer');
    chatContainer.innerHTML = '';
    assignedChats.forEach(chat => {
      const div = document.createElement('div');
      div.style.padding = '5px';
      div.style.borderBottom = '1px solid #eee';
      if(chat.content){
        div.textContent = `${chat.from}: ${chat.content}`;
      } else if(chat.imageURL){
        const img = document.createElement('img');
        img.src = chat.imageURL;
        img.style.maxWidth = '200px';
        img.style.display = 'block';
        div.appendChild(document.createTextNode(`${chat.from}:`));
        div.appendChild(img);
      }
      chatContainer.appendChild(div);
    });
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  document.getElementById('sendBtn').addEventListener('click', () => {
    const input = document.getElementById('messageInput');
    const message = input.value.trim();
    if(!message) return;
    const msgObj = {from: agentId, content: message};
    socket.emit('agent_message', msgObj);
    assignedChats.push(msgObj);
    renderChats();
    logActivity(`You: ${message}`);
    input.value = '';
  });

  function logActivity(text) {
    const log = document.getElementById('activityLog');
    const div = document.createElement('div');
    div.textContent = text;
    log.appendChild(div);
    log.scrollTop = log.scrollHeight;
  }
</script>
</body>
</html>
